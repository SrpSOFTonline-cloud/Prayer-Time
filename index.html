<script>

/* TIME FORMAT */
function formatTime(time24){
 let [h,m]=time24.split(":");
 let ampm = h >= 12 ? "PM" : "AM";
 h = h % 12 || 12;
 return h + ":" + m + " " + ampm;
}

/* UPDATE UI */
function updatePrayer(t,hijriDate){

document.getElementById("fajr").innerText="Fajr: "+formatTime(t.Fajr);
document.getElementById("dhuhr").innerText="Dhuhr: "+formatTime(t.Dhuhr);
document.getElementById("asr").innerText="Asr: "+formatTime(t.Asr);
document.getElementById("maghrib").innerText="Maghrib: "+formatTime(t.Maghrib);
document.getElementById("isha").innerText="Isha: "+formatTime(t.Isha);

document.getElementById("sehri").innerText="Sehri End: "+formatTime(t.Fajr);
document.getElementById("iftar").innerText="Iftar: "+formatTime(t.Maghrib);

document.getElementById("hijri").innerText="Hijri: "+hijriDate;

}

/* GPS LOCATION */
function getLocation(){

if(navigator.geolocation){

navigator.geolocation.getCurrentPosition(success,error);

}else{
loadDhaka();
}

}

/* GPS SUCCESS */
async function success(pos){

let lat=pos.coords.latitude;
let lon=pos.coords.longitude;

try{

let res=await fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=1`);
let data=await res.json();

updatePrayer(data.data.timings,data.data.date.hijri.date);

}catch{
loadDhaka();
}

}

/* GPS FAIL হলে Dhaka */
function error(){
loadDhaka();
}

/* DHAKA FALLBACK */
async function loadDhaka(){

let res=await fetch("https://api.aladhan.com/v1/timingsByCity?city=Dhaka&country=Bangladesh&method=1");
let data=await res.json();

updatePrayer(data.data.timings,data.data.date.hijri.date);

}

/* START */
getLocation();

</script>

