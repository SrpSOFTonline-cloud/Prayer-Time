<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Prayer Time</title>

<style>
:root{
  --bg:#0f172a;
  --card:#1e293b;
  --text:white;
}

.light{
  --bg:#f1f5f9;
  --card:white;
  --text:black;
}

body{
  margin:0;
  font-family: Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  background:var(--card);
  padding:15px;
  text-align:center;
}

.container{
  max-width:700px;
  margin:auto;
  padding:15px;
}

.card{
  background:var(--card);
  padding:18px;
  border-radius:12px;
  margin-top:15px;
}

button,input{
  padding:10px;
  border:none;
  border-radius:8px;
  font-size:16px;
}

button{
  background:#38bdf8;
  cursor:pointer;
}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  padding:10px;
  border-bottom:1px solid gray;
}

footer{
  text-align:center;
  padding:15px;
  margin-top:30px;
}
</style>
</head>

<body>

<header>
<h1>üïå Prayer Time</h1>
<p id="locationText">Loading Location...</p>
<button onclick="toggleTheme()">üåô Toggle Mode</button>
</header>

<div class="container">

<div class="card">
<h3>Change Location</h3>
<input id="cityInput" placeholder="Enter city" />
<button onclick="loadPrayerTimes()">Search</button>
<button onclick="getGPS()">üìç Auto GPS</button>
</div>

<div class="card">
<h2>Today's Prayer Times</h2>
<table id="prayerTable"></table>
</div>

<div class="card">
<h3>Next Prayer Countdown</h3>
<p id="countdown"></p>
</div>

<div class="card">
<h3>üìÖ Monthly Calendar</h3>
<div id="monthly"></div>
</div>

</div>

<footer>
<p>Developer: Shovon</p>
<p>Mobile: 01843860547</p>
</footer>

<audio id="adhanAudio" src="https://cdn.islamic.network/audio/adhan/adhan.mp3"></audio>

<script>
let prayerTimes = {};

function toggleTheme(){
  document.body.classList.toggle("light");
}

async function loadPrayerTimes(){
  let city = document.getElementById("cityInput").value || "Dhaka";
  document.getElementById("locationText").innerText = city + ", Bangladesh";

  let res = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=Bangladesh&method=1`);
  let data = await res.json();

  prayerTimes = data.data.timings;
  displayTable();
  loadMonthly(city);
  requestNotification();
}

function displayTable(){
  let table = document.getElementById("prayerTable");
  let prayers = ["Fajr","Dhuhr","Asr","Maghrib","Isha"];

  table.innerHTML = `<tr><th>Prayer</th><th>Time</th></tr>`;

  prayers.forEach(p => {
    table.innerHTML += `<tr><td>${p}</td><td>${prayerTimes[p]}</td></tr>`;
  });
}

function getNextPrayer(){
  let now = new Date();
  let prayers = ["Fajr","Dhuhr","Asr","Maghrib","Isha"];

  for(let p of prayers){
    let [h,m] = prayerTimes[p].split(":");
    let time = new Date();
    time.setHours(h,m,0);

    if(time > now) return {name:p,time};
  }
}

function updateCountdown(){
  let next = getNextPrayer();
  if(!next) return;

  let diff = next.time - new Date();
  let h = Math.floor(diff/3600000);
  let m = Math.floor(diff/60000)%60;
  let s = Math.floor(diff/1000)%60;

  document.getElementById("countdown").innerText =
  `Next Prayer ${next.name} in ${h}h ${m}m ${s}s`;

  if(diff < 1000){
    document.getElementById("adhanAudio").play();
    sendNotification(next.name);
  }
}

setInterval(updateCountdown,1000);

async function loadMonthly(city){
  let res = await fetch(`https://api.aladhan.com/v1/calendarByCity?city=${city}&country=Bangladesh&method=1`);
  let data = await res.json();

  let html = `<table><tr><th>Date</th><th>Fajr</th><th>Maghrib</th></tr>`;

  data.data.slice(0,10).forEach(day => {
    html += `<tr>
      <td>${day.date.gregorian.date}</td>
      <td>${day.timings.Fajr}</td>
      <td>${day.timings.Maghrib}</td>
    </tr>`;
  });

  html += `</table>`;
  document.getElementById("monthly").innerHTML = html;
}

function getGPS(){
  navigator.geolocation.getCurrentPosition(async pos => {
    let lat = pos.coords.latitude;
    let lon = pos.coords.longitude;

    let res = await fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=1`);
    let data = await res.json();

    prayerTimes = data.data.timings;
    displayTable();
  });
}

function requestNotification(){
  if(Notification.permission !== "granted"){
    Notification.requestPermission();
  }
}

function sendNotification(prayer){
  if(Notification.permission === "granted"){
    new Notification(`Time for ${prayer} prayer`);
  }
}

loadPrayerTimes();
</script>

</body>
</html>
